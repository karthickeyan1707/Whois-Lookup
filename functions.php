.<?php
$whoIsServers = array(

	"edu" => "whois.educause.edu",
	"org" => 'whois.pir.org',
	"app" => "whois.nic.app",
	"in" => "whois.registry.in",
	"ac" => "whois.nic.ac",	
	"ae" => "whois.nic.ae", 
	"aero"=>"whois.aero",
	"af" => "whois.nic.af", 
	"ag" => "whois.nic.ag", 
	"ai" => "whois.ai", 
	"al" => "whois.ripe.net", 
	"am" => "whois.amnic.net", 	
	"arpa" => "whois.iana.org",
	"as" => "whois.nic.as",
	"asia" => "whois.nic.asia",
	"at" => "whois.nic.at", 
	"au" => "whois.aunic.net", 	
	"ax" => "whois.ax", 
	"az" => "whois.ripe.net", 
	"be" => "whois.dns.be",
	"bg" => "whois.register.bg",
	"bi" => "whois.nic.bi",
	"biz" => "whois.biz",
	"bj" => "whois.nic.bj",	
	"bn" => "whois.bn",
	"bo" => "whois.nic.bo", 
	"br" => "whois.registro.br",
	"bt" => "whois.netnames.net", 	
	"by" => "whois.cctld.by", 
	"bz" => "whois.belizenic.bz", 
	"ca" => "whois.cira.ca", 
	"cat" => "whois.cat", 
	"cc" => "whois.nic.cc",
	"cd" => "whois.nic.cd", 	
	"ch" => "whois.nic.ch", 
	"ci" => "whois.nic.ci", 
	"ck" => "whois.nic.ck",
	"cl" => "whois.nic.cl",	
	"cn" => "whois.cnnic.net.cn",
	"co" => "whois.nic.co",
	"com" => "whois.verisign-grs.com",
	"coop" => "whois.nic.coop",	
	"cx" => "whois.nic.cx", 
	"cz" => "whois.nic.cz", 
	"de" => "whois.denic.de",
	"dk" => "whois.dk-hostmaster.dk", 
	"dm" => "whois.nic.dm",	
	"dz" => "whois.nic.dz", 
	"ec" => "whois.nic.ec", 
	"edu" => "whois.educause.edu",
	"ee" => "whois.eenet.ee", 
	"eg" => "whois.ripe.net", 	
	"es" => "whois.nic.es", 
	"eu" => "whois.eu",
	"fi" => "whois.ficora.fi", 
	"fo" => "whois.nic.fo", 
	"fr" => "whois.nic.fr", 
	"gd" => "whois.nic.gd",
	"gg" => "whois.gg", 
	"gi" => "whois2.afilias-grs.net",
	"gl" => "whois.nic.gl", 
	"gov" => "whois.nic.gov",
	"gs" => "whois.nic.gs",
	"gy" => "whois.registry.gy",
	"hk" => "whois.hkirc.hk", 
	"hn" => "whois.nic.hn", 
	"hr" => "whois.dns.hr", 
	"ht" => "whois.nic.ht",
	"hu" => "whois.nic.hu",
	"ie" => "whois.domainregistry.ie", 
	"il" => "whois.isoc.org.il", 
	"im" => "whois.nic.im", 
	"info" => "whois.afilias.net",
	"int" => "whois.iana.org",
	"io" => "whois.nic.io", 
	"iq" => "whois.cmc.iq", 
	"ir" => "whois.nic.ir", 
	"is" => "whois.isnic.is", 
	"it" => "whois.nic.it", 
	"je" => "whois.je", 
	"jobs" => "jobswhois.verisign-grs.com",
	"jp" => "whois.jprs.jp", 
	"ke" => "whois.kenic.or.ke", 
	"kg" => "www.domain.kg", 
	"ki" => "whois.nic.ki", 
	"kr" => "whois.kr", 
	"kz" => "whois.nic.kz",
	"la" => "whois.nic.la",
	"li" => "whois.nic.li", 
	"lt" => "whois.domreg.lt", 
	"lu" => "whois.dns.lu", 
	"lv" => "whois.nic.lv", 
	"ly" => "whois.nic.ly", 
	"ma" => "whois.iam.net.ma", 
	"md" => "whois.nic.md",
	"me" => "whois.nic.me", 
	"mg" => "whois.nic.mg",	
	"mil" => "whois.nic.mil",	
	"ml" => "whois.dot.ml", 	
	"mn" => "whois.nic.mn",
	"mo" => "whois.monic.mo",
	"mobi" => "whois.dotmobiregistry.net",
	"mp" => "whois.nic.mp",	
	"ms" => "whois.nic.ms",	
	"mu" => "whois.nic.mu", 
	"museum" => "whois.museum",
	"mx" => "whois.mx", 
	"my" => "whois.domainregistry.my",
	"na" => "whois.na-nic.com.na",
	"name" => "whois.nic.name",
	"nc" => "whois.nc",
	"net" => "whois.verisign-grs.net",
	"nf" => "whois.nic.nf", 
	"ng" => "whois.nic.net.ng", 
	"nl" => "whois.domain-registry.nl", 
	"no" => "whois.norid.no", 
	"nu" => "whois.nic.nu", 
	"nz" => "whois.srs.net.nz", 
	"om" => "whois.registry.om", 
	"org" => "whois.pir.org",
	"pe" => "kero.yachay.pe", 
	"pf" => "whois.registry.pf", 
	"pl" => "whois.dns.pl", 
	"pm" => "whois.nic.pm", 
	"post" => "whois.dotpostregistry.net",
	"pr" => "whois.nic.pr", 
	"pro" => "whois.dotproregistry.net",
	"pt" => "whois.dns.pt", 
	"pw" => "whois.nic.pw", 
	"qa" => "whois.registry.qa", 
	"re" => "whois.nic.re", 
	"ro" => "whois.rotld.ro", 
	"rs" => "whois.rnids.rs",
	"ru" => "whois.tcinet.ru",
	"sa" => "whois.nic.net.sa", 
	"sb" => "whois.nic.net.sb", 
	"sc" => "whois2.afilias-grs.net", 
	"se" => "whois.iis.se", 
	"sg" => "whois.sgnic.sg", 
	"sh" => "whois.nic.sh", 
	"si" => "whois.arnes.si", 
	"sk" => "whois.sk-nic.sk", 
	"sm" => "whois.nic.sm", 
	"sn" => "whois.nic.sn", 
	"so" => "whois.nic.so", 
	"st" => "whois.nic.st", 
	"su" => "whois.tcinet.ru",
	"sx" => "whois.sx", 
	"sy" => "whois.tld.sy", 
	"tc" => "whois.meridiantld.net", 
	"tel" => "whois.nic.tel",
	"tf" => "whois.nic.tf", 
	"th" => "whois.thnic.co.th", 
	"tj" => "whois.nic.tj", 
	"tk" => "whois.dot.tk", 
	"tl" => "whois.nic.tl", 
	"tm" => "whois.nic.tm", 
	"tn" => "whois.ati.tn", 
	"to" => "whois.tonic.to", 
	"tp" => "whois.nic.tl", 
	"tr" => "whois.nic.tr", 
	"travel" => "whois.nic.travel",
	"tv" => "tvwhois.verisign-grs.com", 
	"tw" => "whois.twnic.net.tw", 
	"tz" => "whois.tznic.or.tz", 
	"ua" => "whois.ua", 
	"ug" => "whois.co.ug",
	"uk" => "rdap.nominet.uk",
	"us" => "whois.nic.us", 
	"uy" => "whois.nic.org.uy", 
	"uz" => "whois.cctld.uz", 
	"vc" => "whois2.afilias-grs.net", 
	"ve" => "whois.nic.ve", 
	"vg" => "whois.adamsnames.tc", 
	"wf" => "whois.nic.wf", 
	"ws" => "whois.website.ws", 
	"xxx" => "whois.nic.xxx",
	"yt" => "whois.nic.yt", 
	"yu" => "whois.ripe.net"
);





function validateDomain($domain) {
    // Extract the hostname from the input URL
    $parsed_url = parse_url($domain);
    $hostname = $parsed_url['host'] ?? $domain;

    // Remove any letters or symbols before validating the domain name
    $hostname = preg_replace('/[^\w\d.-]/i', '', $hostname);

    // Extract the domain name and extension from the input
    $last_dot_pos = strrpos($hostname, '.');
    if ($last_dot_pos === false) {
        return false; // No dot found, invalid domain
    }
    $domain_name = substr($hostname, 0, $last_dot_pos);
    $domain_extension = substr($hostname, $last_dot_pos + 1);

    // Check if the extension has any additional characters after it
    $additional_chars_pos = strpos($domain_extension, '.');
    if ($additional_chars_pos !== false) {
        $domain_extension = substr($domain_extension, 0, $additional_chars_pos);
    }

    // Combine the domain name and extension
    $hostname = $domain_name . '.' . $domain_extension;
    return $hostname;
}




function lookUpDomain($domain){
	global $whoIsServers;
	
	// Extract domain name and extension from input
	$parsed_url = parse_url($domain);
	$hostname = $parsed_url['host'] ?? $domain;
	$hostname = preg_replace('/[^\w\d.-]/i', '', $hostname);
	$domain_parts = explode('.', $hostname);
	$domain_parts = array_slice($domain_parts, -2);
	$domain_extension = strtolower(end($domain_parts));
	$domain_name = strtolower(prev($domain_parts));
	
	// Remove any characters that come after the last dot in the domain name
	$dot_pos = strrpos($domain_name, '.');
	if ($dot_pos !== false) {
		$domain_name = substr($domain_name, 0, $dot_pos);
	}
	
	$domain = $domain_name . '.' . $domain_extension;
	
	$whoIsServer = isset($whoIsServers[$domain_extension]) ? $whoIsServers[$domain_extension] : null;
    if(!$whoIsServer) {
        return "Error: No appropriate Whois server found for $domain domain!";
    } 

	$whoIsResult = getWhoisServerDetails($whoIsServer, $domain);
	if(!$whoIsResult) {
		return "Error: No results retrieved from $whoIsServer server for $domain domain!";
	} else {
		while(strpos($whoIsResult, "Whois Server:") !== FALSE){
			preg_match("/Whois Server: (.*)/", $whoIsResult, $matches);
			$secondary = $matches[1];
			if($secondary) {
				$whoIsResult = getWhoisServerDetails($secondary, $domain);
				if($whoIsResult){
					$whoIsServer = $secondary;
				} else {
					return "Error: No results retrieved from $secondary server for $domain domain!";
				}
			}
		}
	}
	return "$domain domain lookup results from $whoIsServer server:\n\n" . $whoIsResult;
}






function isDomainAvailable($domain) {
	
    $tld = strtolower(substr(strrchr($domain, '.'), 1));
    if ($tld == 'org') {
        $whois = lookUpDomain($domain, 'whois.pir.org');
        if (strpos($whois, 'Domain not found') !== false) {
            // .org domain is available
            return true;
        } else {
            // .org domain is registered
            return false;
        }
    } elseif ($tld == 'app') {
        // Check availability of .app domain using Google Registry WHOIS server
        $whois = lookUpDomain($domain, 'whois.nic.google');
        if (strpos($whois, 'Domain not found') !== false) {
            // .app domain is available
            return true;
        } else {
            // .app domain is not available
            return false;
        }
    } else {
        // Check availability of other domains using generic WHOIS servers
        $whois = lookUpDomain($domain);
        $not_found_strings = array("No match for", "NOT FOUND", "Not found:", "AVAILABLE", "AVAILABLE\n");
        foreach ($not_found_strings as $string) {
            if (strpos($whois, $string) !== false) {
                return true;
            }
        }
        return false;
    }
}






function getWhoisServerDetails($whoIsServer, $domain) {
	$port = 43;
	$timeout = 10;
	$whoIsInfo = @fsockopen($whoIsServer, $port, $errno, $errstr, $timeout) or die("Socket Error " . $errno . " - " . $errstr);	
	fputs($whoIsInfo, $domain . "\r\n");
	$output = "";
	while(!feof($whoIsInfo)){
		$output .= fgets($whoIsInfo);
	}
	fclose($whoIsInfo);
	$whosIsResults = "";
	if((strpos(strtolower($output), "error") === FALSE) && (strpos(strtolower($output), "not allocated") === FALSE)) {
		$whoIsRecords = explode("\n", $output);
		foreach($whoIsRecords as $whoIsRecord) {
			$whoIsRecord = trim($whoIsRecord);
			if(($whoIsRecord != '') && ($whoIsRecord[0] != '#') && ($whoIsRecord[0] != '%')) {
				$whosIsResults .= $whoIsRecord."\n";
			}
		}
	}
	return $whosIsResults;
}

?>